<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

  <!-- üîù –¢—ñ–ª –º–µ–Ω —à—ã“ì—É -->
  <div class="bg-white shadow p-4 flex justify-between items-center">
    <div class="text-sm space-x-2">
      <button onclick="setLanguage('kk')" class="text-blue-600 hover:underline">KAZ</button>
      <span>/</span>
      <button onclick="setLanguage('ru')" class="text-blue-600 hover:underline">RU</button>
    </div>
    <a id="logout-button" href="/" class="text-sm bg-red-500 text-white px-4 py-1 rounded hover:bg-red-600">–®—ã“ì—É</a>
  </div>

  <!-- üëã –°”ô–ª–µ–º -->
  <div class="mt-10 text-center">
    <h1 id="greeting" data-name="{{ name }}" class="text-4xl font-bold text-gray-800">
      –°”ô–ª–µ–º, {{ name }}
    </h1>
  </div>

  <!-- üìÜ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
  <div class="mt-8 px-6 flex justify-center">
    <div class="bg-white shadow rounded-xl w-full max-w-6xl p-6">

      <!-- üîù –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∂”ô–Ω–µ “õ–æ—Å—É –∫–Ω–æ–ø–∫–∞—Å—ã -->
      <div class="flex justify-between items-center mb-6">
        <h2 id="store-title" class="text-xl font-semibold text-gray-800">–ú–∞–≥–∞–∑–∏–Ω–¥–µ—Ä—ñ“£—ñ–∑</h2>
        <button onclick="openModal()" id="add-button"
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm">
          + –ú–∞–≥–∞–∑–∏–Ω “õ–æ—Å—É
        </button>
      </div>

      <!-- üîà –ú–∞–≥–∞–∑–∏–Ω –∫–∞—Ä—Ç–æ—á–∫–∞–ª–∞—Ä—ã -->
      <div id="store-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
        <!-- JS –∞—Ä“õ—ã–ª—ã “õ–æ—Å—ã–ª–∞—Ç—ã–Ω –∫–∞—Ä—Ç–æ—á–∫–∞–ª–∞—Ä –æ—Å—ã–Ω–¥–∞ —Ç“Ø—Å–µ–¥—ñ -->
      </div>

    </div>
  </div>

  <!-- üö™ –ú–æ–¥–∞–ª —Ç–µ—Ä–µ–∑–µ -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-md relative">
      <!-- ‚ùå –ñ–∞–±—É -->
      <button onclick="closeModal()" class="absolute top-2 right-3 text-gray-400 hover:text-black text-xl">&times;</button>

      <!-- üìí –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
      <h2 id="modal-title" class="text-xl font-bold text-center mb-4">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞</h2>

      <!-- üñº Kaspi –∏–∫–æ–Ω–∫–∞—Å—ã -->
      <div class="flex justify-center items-center space-x-2 mb-4">
        <img src="https://upload.wikimedia.org/wikipedia/ru/a/aa/Logo_of_Kaspi_bank.png"
             alt="Kaspi" class="w-10 h-10 object-contain">
        <span class="text-lg font-semibold text-gray-800">Kaspi</span>
      </div>

      <!-- ‚úâÔ∏è –ø–æ email -->
      <p id="email-label" class="text-center text-sm text-gray-500 mb-2">–ø–æ email</p>

      <!-- üìù –§–æ—Ä–º–∞–ª–∞—Ä -->
      <input id="store-email" type="email" placeholder="Email"
             class="border p-2 rounded w-full mb-3" />

      <div class="relative mb-4">
        <input id="store-password" type="password" placeholder="–ü–∞—Ä–æ–ª—å"
               class="border p-2 rounded w-full pr-10" />
        <button type="button" onclick="togglePassword()" class="absolute inset-y-0 right-2 flex items-center text-gray-500">
          üëÅÔ∏è
        </button>
      </div>

      <!-- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å -->
      <button id="modal-add-button"
              class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 text-sm">
        –î–æ–±–∞–≤–∏—Ç—å
      </button>
    </div>
  </div>

  <!-- üîª HTML –±–∞—Å—ã ”©–∑–≥–µ—Ä–º–µ–π–¥—ñ -->
<!-- ... -->

<!-- ‚úÖ –°–∫—Ä–∏–ø—Ç —Å–æ“£—ã–Ω–¥–∞: Kaspi –º–∞–≥–∞–∑–∏–Ω “õ–æ—Å—É –ª–æ–≥–∏–∫–∞—Å—ã -->
<script>
  const texts = {
    kk: {
      logout: "–®—ã“ì—É",
      greeting: "–°”ô–ª–µ–º, ",
      store_title: "–ú–∞–≥–∞–∑–∏–Ω–¥–µ—Ä—ñ“£—ñ–∑",
      add_button: "+ –ú–∞–≥–∞–∑–∏–Ω “õ–æ—Å—É",
      modal_title: "–ú–∞–≥–∞–∑–∏–Ω “õ–æ—Å—É",
      modal_email_label: "email –∞—Ä“õ—ã–ª—ã",
      modal_add: "“ö–æ—Å—É"
    },
    ru: {
      logout: "–í—ã–π—Ç–∏",
      greeting: "–ü—Ä–∏–≤–µ—Ç, ",
      store_title: "–í–∞—à–∏ –º–∞–≥–∞–∑–∏–Ω—ã",
      add_button: "+ –î–æ–±–∞–≤–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω",
      modal_title: "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞",
      modal_email_label: "–ø–æ email",
      modal_add: "–î–æ–±–∞–≤–∏—Ç—å"
    }
  };

  function setLanguage(lang) {
    const t = texts[lang];
    document.getElementById("logout-button").innerText = t.logout;
    document.getElementById("store-title").innerText = t.store_title;
    document.getElementById("add-button").innerText = t.add_button;
    document.getElementById("modal-title").innerText = t.modal_title;
    document.getElementById("email-label").innerText = t.modal_email_label;
    document.getElementById("modal-add-button").innerText = t.modal_add;

    const name = document.getElementById("greeting").getAttribute("data-name");
    document.getElementById("greeting").innerText = t.greeting + name;

    localStorage.setItem("lang", lang);
  }

  function openModal() {
    document.getElementById("modal").classList.remove("hidden");
  }

  function closeModal() {
    document.getElementById("modal").classList.add("hidden");
  }

  function togglePassword() {
    const input = document.getElementById("store-password");
    input.type = input.type === "password" ? "text" : "password";
  }

  window.onload = () => {
    const lang = localStorage.getItem("lang") || "kk";
    setLanguage(lang);
  };

  // ‚úÖ Kaspi –º–∞–≥–∞–∑–∏–Ω “õ–æ—Å—É –ª–æ–≥–∏–∫–∞—Å—ã
  document.getElementById("modal-add-button").addEventListener("click", async () => {
    const login = document.getElementById("store-email").value.trim();
    const password = document.getElementById("store-password").value.trim();

    if (!login || !password) {
      alert("‚ö†Ô∏è –õ–æ–≥–∏–Ω –º–µ–Ω –ø–∞—Ä–æ–ª—å–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑");
      return;
    }

    try {
      const res = await fetch("/add_kaspi_shop", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({ login, password })
      });

      const data = await res.json();

      if (data.ok) {
        alert("‚úÖ –ú–∞–≥–∞–∑–∏–Ω “õ–æ—Å—ã–ª–¥—ã: " + data.name);
        closeModal();

        // ‚ûï UI-–≥–µ –º–∞–≥–∞–∑–∏–Ω –∫–∞—Ä—Ç–æ—á–∫–∞—Å—ã–Ω “õ–æ—Å—É
        const card = document.createElement("div");
        card.className = "border p-4 rounded shadow bg-white";
        card.innerHTML = `
          <h3 class="font-bold text-lg mb-1">${data.name}</h3>
          <p class="text-sm text-gray-500">${login}</p>
        `;
        document.getElementById("store-list").appendChild(card);

        // –§–æ—Ä–º–∞ —Ç–∞–∑–∞–ª–∞—É
        document.getElementById("store-email").value = "";
        document.getElementById("store-password").value = "";

      } else {
        alert("‚ùå “ö–∞—Ç–µ: " + data.msg);
      }

    } catch (e) {
      console.error(e);
      alert("‚ùå –°–µ—Ä–≤–µ—Ä–≥–µ “õ–æ—Å—ã–ª—É “õ–∞—Ç–µ—Å—ñ");
    }
  });
</script>
</body>
</html>
